#!/bin/bash

# Update package database and upgrade all packages
sudo pacman -Syu --noconfirm
if [ $? -ne 0 ]; then
    echo "Failed to update and upgrade packages."
    exit 1
fi

# Install required packages
packages=(
    yay,            # AUR helper (must be installed before other AUR packages)
    jq              # Json parser
    stow            # Needed for config linking
    zoxide          # better cd command
    eza             # modern ls replacement
    lazygit         # git overpowered TUI
    nvim            # Code editor
    waybar          # status bar
    zen-browser-bin # Browser
    discord
    alacrity        # terminal emulator
    hyprlock        # screen locker
    hyprsunset      # automatic brightness and color temperature adjustment
    hypridle        # automatic screen locking on idle
)

# TODO [hcabel 2026-01-03]: Make fish default shell

for package in "${packages[@]}"; do
    # Deternine if it's in official repos or AUR
    sudo pacman -Q "$package" &> /dev/null
    if [ $? -eq 1 ]; then
        yay -S --noconfirm "$package"
        if [ $? -ne 0 ]; then
            echo "Installation failed ($package)."
            exit 1
        fi
    else
        sudo pacman -S --noconfirm "$package"
        if [ $? -ne 0 ]; then
            echo "Pacman installation failed ($package)."
            exit 1
        fi
    fi
done
