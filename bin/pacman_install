#!/bin/bash

# Update package database and upgrade all packages
sudo pacman -Syu --noconfirm
if [ $? -ne 0 ]; then
    echo "Failed to update and upgrade packages."
    exit 1
fi

# Install required packages
packages=(
    yay             # AUR helper (must be installed before other AUR packages)
    jq              # Json parser
    stow            # Needed for config linking
    zoxide          # better cd command
    eza             # modern ls replacement
    fish            # Shell
    lazygit         # git overpowered TUI
    waybar          # status bar
    zen-browser-bin # Browser
    discord
    alacritty        # terminal emulator
    hyprlock        # screen locker
    hyprsunset      # automatic brightness and color temperature adjustment
    hypridle        # automatic screen locking on idle

    # Dev tools
    nvim            # Code editor
    rust-analyzer   # Rust language server
    lua-language-server
    gopls
    typescript-language-server
    ccls
    tree-sitter-cli  # for nvim treesitter
)

for package in "${packages[@]}"; do
    echo ">> Installing: \"$package\" <<"
    sudo pacman -Ss "$package" &> /dev/null
    if [ $? -eq 1 ]; then
        yay -S --noconfirm "$package"
        if [ $? -ne 0 ]; then
            echo "Installation failed ($package)."
            exit 1
        fi
    else
        sudo pacman -S --noconfirm "$package"
        if [ $? -ne 0 ]; then
            echo "Pacman installation failed ($package)."
            exit 1
        fi
    fi
done
