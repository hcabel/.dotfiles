#!/bin/bash

# Update package database and upgrade all packages
sudo dnf -y upgrade
if [ $? -ne 0 ]; then
    echo "Failed to update and upgrade packages."
    exit 1
fi

# Install required packages
packages=(
    jq                  # Json parser
    stow                # Needed for config linking
    zoxide              # better cd command
    eza                 # modern ls replacement
    fish                # Shell
    lazygit             # git overpowered TUI
    waybar              # status bar
    app.zen_browser.zen # Browser
    discord
    alacritty           # terminal emulator
    hyprlock            # screen locker
    hyprsunset          # automatic brightness and color temperature adjustment
    hypridle            # automatic screen locking on idle

    # Dev tools
    nvim            # Code editor
    rust-analyzer   # Rust language server
    # TODO [hcabel 2026-01-06]: lua-language-server
    gopls
    # TODO [hcabel 2026-01-06]: typescript-language-server
    # TODO [hcabel 2026-01-06]: ccls
    tree-sitter-cli  # for nvim treesitter
)

for package in "${packages[@]}"; do
    echo ""
    echo ">> Installing: \"$package\" <<"
    sudo dnf info "$package" &> /dev/null
    if [ $? -eq 1 ]; then
        flatpak install -y "$package"
        if [ $? -ne 0 ]; then
            echo "Installation failed ($package)."
            exit 1
        fi
    else
        sudo dnf install -y "$package"
        if [ $? -ne 0 ]; then
            echo "Pacman installation failed ($package)."
            exit 1
        fi
    fi
done
