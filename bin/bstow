#!/bin/bash

DOTFILES_DIR="$HOME/.dotfiles"

if [ -z "$1" ]; then
    echo "Usage: $0 <package-name>"
    exit 1
fi

DISTRO="$1"
DISTRO_DIR="$DOTFILES_DIR/$DISTRO"

PACKAGE_NAME="$2"
PACKAGE_DIR="$DOTFILES_DIR/$DISTRO/$PACKAGE_NAME"
PKG_DESTINATION="$HOME/.config/$PACKAGE_NAME"

# Check if the package directory exist
if [ ! -d "$PACKAGE_DIR" ]; then
   echo "$PACKAGE_DIR" "$DISTRO_DIR"
    echo "Error: Package '$PACKAGE_NAME' does not exist in $DOTFILES_DIR."
    exit 1
fi

# If package is already exist and isn't a symlink, rename it to .bak
if [ -d "$PKG_DESTINATION" ] && [ ! -L "$PKG_DESTINATION" ]; then
    echo "Renaming existing directory '$PKG_DESTINATION' to '${PKG_DESTINATION}.bak'..."
    mv "$PKG_DESTINATION" "${PKG_DESTINATION}.bak"
fi

# Stow the package
stow -d "$DISTRO_DIR" -t "$HOME" "$PACKAGE_NAME"

